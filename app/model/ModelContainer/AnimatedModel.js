/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/
        
import React, { useEffect, useRef } from 'react'
import { useAnimations } from '@react-three/drei'
import { useCharAnim } from '../../contexts/CharAnimProvider'

export default function AnimatedModel({position, nodes, materials, animations, model}) {
  const group = useRef();
  const { actions, names } = useAnimations(animations, group);
  const {setAnimations, animationIndex} = useCharAnim();

  useEffect(() => {
    setAnimations(names);
  }, [])

  useEffect(() => {
    actions[names[animationIndex]].reset().fadeIn(0.5).play();

    return () => {
      actions[names[animationIndex]]?.fadeOut(0.5);
    }
  }, [animationIndex])
  
  return (
    <group ref={group} position={position} dispose={null}>
      <group scale={1.91} >
        <primitive object={nodes.root} />
        <skinnedMesh 
          geometry={nodes[model].geometry} 
          material={materials.color_main} 
          skeleton={nodes[model].skeleton} 
        />
      </group>
    </group>
  )
}

//useGLTF.preload('/assets/models/druid.gltf')
